(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{600:function(i,e,t){"use strict";t.r(e);var n=t(54),s=t("WJmte7vdUI"),o=t("sj1dvN3KFL"),r=t(11),a=t("Gj4LsyziGG"),u=t("n7trpTdQyi"),c=t("+S6I2nGzUR");class h{constructor(i,e,t,n,s,o,r,a,u,c){this.yi=i,this.ji=e,this.xi=t,this.zi=n+"/safari/"+e,this.Vi=s||"/service-worker.js",this.qi=o,this.wt=r,this.Yi=a||!1,this.Ji=u||!1,this.h=c,this.Ki="serviceWorker"in navigator&&"undefined"!=typeof ServiceWorkerRegistration&&"showNotification"in ServiceWorkerRegistration.prototype&&"PushManager"in window,this.Qi="safari"in window&&"pushNotification"in window.safari&&"function"==typeof window.safari.pushNotification.permission&&"function"==typeof window.safari.pushNotification.requestPermission}Xi(){return this.Ji}isPushSupported(){return this.Ki||this.Qi}isPushBlocked(){const i=this.isPushSupported()&&"Notification"in window&&null!=window.Notification&&null!=window.Notification.permission&&"denied"===window.Notification.permission,e=this.isPushSupported()&&(!("Notification"in window)||null==window.Notification);return i||e}isPushPermissionGranted(){return this.isPushSupported()&&"Notification"in window&&null!=window.Notification&&null!=window.Notification.permission&&"granted"===window.Notification.permission}Ye(){return!this.isPushBlocked()&&this.isPushSupported()&&!this.isPushPermissionGranted()}Zi(i,e,t,n,s){i.unsubscribe().then((i=>{i?this.$i(e,t,n,s):(r.a.D.error("Failed to unsubscribe device from push."),"function"==typeof s&&s(!1))})).catch((i=>{r.a.D.error("Push unsubscription error: "+i),"function"==typeof s&&s(!1)}))}hn(i,e,t){const n=(i=>{if("string"==typeof i)return i;if(0!==i.endpoint.indexOf("https://android.googleapis.com/gcm/send"))return i.endpoint;let e=i.endpoint;return i.dn&&-1===i.endpoint.indexOf(i.dn)&&(e=i.endpoint+"/"+i.dn),e})(i);let s=null,o=null;if(null!=i.getKey)try{s=btoa(String.fromCharCode.apply(null,new Uint8Array(i.getKey("p256dh")))),o=btoa(String.fromCharCode.apply(null,new Uint8Array(i.getKey("auth"))))}catch(i){if("invalid arguments"!==i.message)throw i}const r=(i=>{let e;return i.options&&(e=i.options.applicationServerKey)&&e.byteLength&&e.byteLength>0?btoa(String.fromCharCode.apply(null,new Uint8Array(e))).replace(/\+/g,"-").replace(/\//g,"_"):null})(i);this.yi.fn(n,t,s,o,r),n&&"function"==typeof e&&e(n,s,o)}pn(){this.yi.wn(!0)}bn(i,e){this.yi.wn(!1),r.a.D.info(i),"function"==typeof e&&e(!1)}gn(i,e,t,n){if("default"===e.permission)try{window.safari.pushNotification.requestPermission(this.zi,i,{api_key:this.ji,device_id:this.xi.te().id},(e=>{"granted"===e.permission&&this.yi.setPushNotificationSubscriptionType(u.a.NotificationSubscriptionTypes.OPTED_IN),this.gn(i,e,t,n)}))}catch(i){this.bn("Could not request permission for push: "+i,n)}else"denied"===e.permission?this.bn("The user has blocked notifications from this site, or Safari push is not configured in the Braze dashboard.",n):"granted"===e.permission&&(r.a.D.info("Device successfully subscribed to push."),this.hn(e.deviceToken,t,new Date))}yn(i,e,t){const n=n=>{switch(n){case"granted":return void("function"==typeof i&&i());case"default":return void("function"==typeof e&&e());case"denied":return void("function"==typeof t&&t());default:r.a.D.error("Received unexpected permission result "+n)}};let s=!1;const o=window.Notification.requestPermission((i=>{s&&n(i)}));o?o.then((i=>{n(i)})):s=!0}$i(i,e,t,n){const s={userVisibleOnly:!0};null!=e&&(s.applicationServerKey=e),i.pushManager.subscribe(s).then((i=>{r.a.D.info("Device successfully subscribed to push."),this.hn(i,t,new Date)})).catch((i=>{this.isPushBlocked()?(r.a.D.info("Permission for push notifications was denied."),"function"==typeof n&&n(!1)):r.a.D.error("Push subscription failed: "+i)}))}vn(){return this.Yi?navigator.serviceWorker.getRegistration():navigator.serviceWorker.register(this.Vi).then((()=>navigator.serviceWorker.ready.then((i=>(i&&"function"==typeof i.update&&i.update().catch((i=>{r.a.D.info("ServiceWorker update failed: "+i)})),i)))))}Pn(i){this.Yi||(i.unregister(),r.a.D.info("Service worker successfully unregistered."))}subscribe(i,e){if(this.isPushSupported()){if(this.Ki){if(!this.Yi&&null!=window.location){let i=this.Vi;-1===i.indexOf(window.location.host)&&(i=window.location.host+i),-1===i.indexOf(window.location.protocol)&&(i=window.location.protocol+"//"+i);const e=i.substr(0,i.lastIndexOf("/")+1);if(0!==c.a.kn().indexOf(e))return void r.a.D.error("Cannot subscribe to push from a path higher than the service worker location (tried to subscribe from "+window.location.pathname+" but service worker is at "+i+")")}if(this.isPushBlocked())return void this.bn("Notifications from this site are blocked. This may be a temporary embargo or a permanent denial.",e);if(this.wt&&!this.wt.Sn()&&0===this.wt.Gs())return r.a.D.info("Waiting for VAPID key from server config before subscribing to push."),void this.wt.Dn((()=>{this.subscribe(i,e)}));const t=()=>{r.a.D.info("Permission for push notifications was denied."),"function"==typeof e&&e(!1)},n=()=>{let i="Permission for push notifications was ignored.";this.isPushBlocked()&&(i+=" The browser has automatically blocked further permission requests for a period (probably 1 week)."),r.a.D.info(i),"function"==typeof e&&e(!0)},h=this.isPushPermissionGranted(),p=()=>{h||this.yi.setPushNotificationSubscriptionType(u.a.NotificationSubscriptionTypes.OPTED_IN),this.vn().then((t=>{if(null==t)return r.a.D.error("No service worker registration. Set the `manageServiceWorkerExternally` initialization option to false or ensure that your service worker is registered before calling registerPush."),void("function"==typeof e&&e());t.pushManager.getSubscription().then((n=>{let u=null;if(this.wt&&null!=this.wt.Sn()&&(u=r.a.Nn._n(this.wt.Sn())),n){let c=null,h=null;const p=this.h.I(a.a.q.Wn);if(p&&!Object(s.a)(p)){let i;try{i=o.a.jn(p).An}catch(e){i=null}null==i||isNaN(i.getTime())||0===i.getTime()||(c=i,h=new Date(c),h.setMonth(c.getMonth()+6))}null!=u&&n.options&&n.options.applicationServerKey&&n.options.applicationServerKey.byteLength&&n.options.applicationServerKey.byteLength>0&&!Object(s.c)(u,new Uint8Array(n.options.applicationServerKey))?(n.options.applicationServerKey.byteLength>12?r.a.D.info("Device was already subscribed to push using a different VAPID provider, creating new subscription."):r.a.D.info("Attempting to upgrade a gcm_sender_id-based push registration to VAPID - depending on the browser this may or may not result in the same gcm_sender_id-based subscription."),this.Zi(n,t,u,i,e)):n.expirationTime&&new Date(n.expirationTime)<=(new Date).valueOf()?(r.a.D.info("Push subscription is expired, creating new subscription."),this.Zi(n,t,u,i,e)):p&&Object(s.a)(p)?this.Zi(n,t,u,i,e):null==h?(r.a.D.info("No push subscription creation date found, creating new subscription."),this.Zi(n,t,u,i,e)):h<=(new Date).valueOf()?(r.a.D.info("Push subscription older than 6 months, creating new subscription."),this.Zi(n,t,u,i,e)):(r.a.D.info("Device already subscribed to push, sending existing subscription to backend."),this.hn(n,i,c))}else this.$i(t,u,i,e)})).catch((i=>{r.a.D.error("Error checking current push subscriptions: "+i)}))})).catch((i=>{r.a.D.error("ServiceWorker registration failed: "+i)}))};this.yn(p,n,t)}else if(this.Qi){if(null==this.qi||""===this.qi)return void r.a.D.error("You must supply the safariWebsitePushId initialization option in order to use registerPush on Safari");const t=window.safari.pushNotification.permission(this.qi);this.gn(this.qi,t,i,e)}}else r.a.D.info(this.Un)}unsubscribe(i,e){this.isPushSupported()?this.Ki?navigator.serviceWorker.getRegistration().then((t=>{t&&t.pushManager.getSubscription().then((n=>{n&&(this.pn(),n.unsubscribe().then((n=>{n?(r.a.D.info("Device successfully unsubscribed from push."),"function"==typeof i&&i()):(r.a.D.error("Failed to unsubscribe device from push."),"function"==typeof e&&e()),this.Pn(t)})).catch((i=>{r.a.D.error("Push unsubscription error: "+i),"function"==typeof e&&e()})))})).catch((i=>{r.a.D.error("Error unsubscribing from push: "+i),"function"==typeof e&&e()}))})):this.Qi&&(this.pn(),r.a.D.info("Device unsubscribed from push."),"function"==typeof i&&i()):r.a.D.info(this.Un)}}h.Un="Push notifications are not supported in this browser.";const p={t:!1,pushManager:null,Xe:()=>(p.o(),p.pushManager||(p.pushManager=new h(n.b.gr(),n.b.aa(),n.b.ce(),n.b.Js(),n.b.nn(n.a.ea),n.b.nn(n.a.na),n.b.ir(),n.b.nn(n.a.ra),n.b.nn(n.a.ta),n.b.l())),p.pushManager),o:()=>{p.t||(n.b.u(p),p.t=!0)},destroy:()=>{p.pushManager=null,p.t=!1}};e.default=p}}]);
//# sourceMappingURL=32.94bb6d8935a0e186ab0cd7517139.js.map
//# debugId=c3e4c3a3-daf9-5b9b-b8b3-5a8e2e64159d